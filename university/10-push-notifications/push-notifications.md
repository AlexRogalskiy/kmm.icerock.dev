---
sidebar_position: 1
---

# Push notifications

## Notifications

Push notifications - это те всплывающие сообщения-уведомления, которые были отправлены сервером.  
Чтобы получше разобраться с тем, что такое пуши и для чего они используются, советуем прочитать [статью](https://www.sostav.ru/blogs/254470/32008/).

Используя Firebase можно отправлять два типа уведомлений - Notification message и Data message. О разнице между ними вы можете узнать из [документации](https://firebase.google.com/docs/cloud-messaging/concept-options) и [видео](https://www.youtube.com/watch?v=61lY61gUq3g).

## Firebase Cloud Messaging
[Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging) (FCM) - это сервис, позволяющий интегрировать отправку push-уведомлений в ваше приложение.

<iframe src="//www.youtube.com/embed/sioEY4tWmLI" frameborder="0" allowfullscreen width="675" height="380"></iframe>
<br/>
<br/>

Чтобы использовать FCM в вашем мультиплатформенном приложении, необходимо выполнить следующие действия:
- зарегистрировать приложение в Firebase
- настроить FCM на каждой платформе
- в общем коде добавить логику отправки уникального токена устройства на сервер 
- в серверную часть приложения добавить логику отправки push-уведомлений

## Registration token
FCM Registration token - это уникальный для каждого устройства ключ, генерируемый FCM. Он нужен для того, чтобы идентифицировать устройство и отправлять пуши конкретно на него.

Токен не фиксированный, он может измениться в следующих случаях:
- для одной учетной записи (email, телефон и тд.), но на разных устройствах, токен будет разным
- приложение переустановлено на устройстве, токен изменится
- при выходе из учетной записи мы вручную сбросим старый токен, чтобы при логине в новую учетку не приходили пуши от прошлой
- удалены данные приложения

Поэтому, платформа должна реагировать не только на получение нового токена, но и на его обновление.

## Работа платформы, общего кода и сервера

### Платформа
Платформа отвечает только за то, что реагирует на получение `FCM token-а` и его передачу в общий код.

### Общий код
В общем коде новый/обновленный токен устройства отправляется на сервер.

### Сервер
Сервер получает FCM token от общего кода и действует в зависимости от логики работы приложения на нескольких устройствах:
- если приложение поддерживает использование одной учетной записи на нескольких девайсах, то сервер просто сохраняет все токены устройств, на которых используется учетная запись
- если использовать приложение можно только на одном устройстве - старый токен перезаписывается
- если произошло обновление токена конкретного устройства - сервер его обновит

Вся логика по отправке пушей и настройке их контента полностью происходит на сервере. Это позволяет быстро что-то добавить/изменить в поведении пушей, без необходимости просить пользователей обновить приложение.
